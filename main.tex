% !TeX program = xelatex
% !TeX encoding = UTF-8

\documentclass[11pt,a4paper,twoside]{book}
%------------------------------------------------------------------% Özel tablo ortamı--------------
% TEMEL PAKETLER VE AYARLAR
%----------------------------------------------------------------------------------------

% Sayfa düzeni ve kenar boşlukları
\usepackage[top=1.2cm, bottom=1.2cm, left=1.2cm, right=1.2cm, includeheadfoot, marginparwidth=2cm, bindingoffset=1cm]{geometry}
\usepackage{graphicx}
\usepackage{float}
\usepackage[table,xcdraw]{xcolor}
\usepackage{rotating}
\usepackage{pdflscape}
\usepackage{afterpage}
\usepackage{placeins}
\usepackage{multirow}

% Türkçe dil desteği
\usepackage{fontspec}
\usepackage{polyglossia}
\setdefaultlanguage{turkish}

% Font ayarları - Basit ve güvenilir fontlar
\setmainfont{Times New Roman}[Ligatures=TeX]
\setsansfont{Arial}
\setmonofont{Courier New}

% Mikro tipografi ayarları
\usepackage[activate={true,nocompatibility},final,tracking=true,kerning=true,spacing=true]{microtype}
\LoadMicrotypeFile{xetex}
\microtypecontext{spacing=nonfrench}
\SetTracking{encoding={*}, shape=sc}{40}

% Sayfa düzeni toleransları
\tolerance=2000
\emergencystretch=3em
\hyphenpenalty=50
\exhyphenpenalty=50
\doublehyphendemerits=1000
\finalhyphendemerits=1000
\brokenpenalty=100
\pretolerance=100
\binoppenalty=700
\relpenalty=500
\parfillskip=0pt plus 0.8\textwidth
\setlength{\parindent}{1em}
\setlength{\parskip}{0.5ex plus 0.3ex minus 0.2ex}
\clubpenalty=10000
\widowpenalty=10000
\displaywidowpenalty=50
\predisplaypenalty=10000
\postdisplaypenalty=1000
\floatingpenalty=20000
\raggedbottom
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}

%----------------------------------------------------------------------------------------
%	MATEMATİK VE TABLO PAKETLERİ
%----------------------------------------------------------------------------------------

\usepackage{amsmath}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{array}
\usepackage{booktabs}
\usepackage{adjustbox}

% Gelişmiş Tablo Ayarları
\usepackage{colortbl}
\usepackage[table]{xcolor}

% Tablo renklendirme için renkler
\definecolor{tableheadcolor}{RGB}{235,241,255}
\definecolor{tablerowcolor}{RGB}{249,251,255}
\definecolor{tablebordercolor}{RGB}{68,114,196}

% Tablo hücre ayarları
\setlength{\tabcolsep}{8pt}
\renewcommand{\arraystretch}{1.5}

% Longtable global ayarları
\setlength{\LTpre}{2em}
\setlength{\LTpost}{2em}
\setlength{\LTleft}{0pt plus 1fill}
\setlength{\LTright}{0pt plus 1fill}
\setlength{\LTcapwidth}{0.9\textwidth}
\newlength{\LTwidth}
\setlength{\LTwidth}{0.95\textwidth}

% Özel kolon tipleri
\newcolumntype{L}[1]{>{\raggedright\arraybackslash\hspace{0pt}\small}p{#1}}
\newcolumntype{C}[1]{>{\centering\arraybackslash\hspace{0pt}\small}p{#1}}
\newcolumntype{R}[1]{>{\raggedleft\arraybackslash\hspace{0pt}\small}p{#1}}
\newcolumntype{M}[1]{>{\centering\arraybackslash\small}m{#1}}
% Otomatik genişlikli kolon tipleri
\newcolumntype{Y}{>{\raggedright\arraybackslash\small}X}
\newcolumntype{Z}{>{\raggedleft\arraybackslash\small}X}

% Tablo stil komutları
\newcommand{\tableheadstyle}{\bfseries\color{blue!70!black}\centering\small}
\newcommand{\tablecellstyle}{\small\color{black}\centering}
\newcommand{\tablefootstyle}{\small\color{blue!50!black}\centering}

% Tablo çizgileri ve renkler birleştirildi
% arraystretch zaten yukarıda 1.5 olarak ayarlı
\setlength{\arrayrulewidth}{1pt}
\arrayrulecolor{tablebordercolor}

% Özel tablo ortamları
\newenvironment{customtable}[1]{%
    \begin{center}
    \rowcolors{2}{tablerowcolor}{white}
    \begin{tabularx}{\textwidth}{#1}  % tabularx kullanıyoruz
    \rowcolor{tableheadcolor}
}{%
    \end{tabularx}
    \end{center}
}

% Otomatik hücre ortalama 
\renewcommand{\tabularxcolumn}[1]{>{\centering\arraybackslash}p{#1}}

% Longtable başlık tekrarı için
\renewcommand{\LTchunksize}{50}

% Tablo genişliği için yardımcı komut
\newcommand{\adjusttablewidth}[1][0.95]{%
    \setlength{\LTwidth}{#1\textwidth}%
    \setlength{\LTleft}{0pt plus 1fill}%
    \setlength{\LTright}{0pt plus 1fill}%
}



%----------------------------------------------------------------------------------------
%	KOD BLOKLARI VE LİSTELEME AYARLARI
%----------------------------------------------------------------------------------------

\usepackage{listings}
\usepackage{fancyvrb}
\usepackage{enumitem}

% Gelişmiş kod blokları için ayarlar
\lstset{
    breaklines=true,
    breakatwhitespace=true,
    postbreak=\mbox{\textcolor{red}{$\hookrightarrow$}\space},
    basicstyle=\ttfamily\small,
    numbers=left,
    numberstyle=\tiny\color{gray},
    numbersep=5pt,
    frame=single,
    framesep=3pt,
    framerule=1pt,
    showstringspaces=false,
    tabsize=2,
    captionpos=b,
    backgroundcolor=\color{gray!5},
    rulecolor=\color{gray!30},
    keywordstyle=\color{blue!70!black}\bfseries,
    commentstyle=\color{green!60!black}\itshape,
    stringstyle=\color{red!60!black},
    identifierstyle=\color{black},
    columns=fixed,
    keepspaces=true,
    basewidth=0.5em,
    xleftmargin=2em,
    xrightmargin=2em,
    linewidth=0.95\textwidth,
    upquote=true,
    aboveskip=\bigskipamount,
    belowskip=\bigskipamount,
    language=Python
}

% Liste ayarları
\setlist{noitemsep} % Madde işaretleri arasındaki boşluğu azalt
\setlist[itemize,1]{label={\textcolor{blue!70!black}{$\bullet$}}}
\setlist[itemize,2]{label={\textcolor{blue!50!black}{$\circ$}}}
\setlist[itemize,3]{label={\textcolor{blue!30!black}{$\diamond$}}}

% Numaralı listeler için
\setlist[enumerate,1]{label={\textcolor{blue!70!black}{\arabic*.}}}
\setlist[enumerate,2]{label={\textcolor{blue!50!black}{\alph*.}}}
\setlist[enumerate,3]{label={\textcolor{blue!30!black}{\roman*.}}}

% Verbatim ortamı için birleştirilmiş ayarlar
\fvset{
    frame=single,
    numbers=left,
    framesep=3mm,
    numbersep=3mm,
    fontsize=\small,
    commandchars=\\\{\},
    fillcolor=\color{gray!5},
    rulecolor=\color{gray!30},
    xleftmargin=0.5cm,
    xrightmargin=0.5cm
}

%----------------------------------------------------------------------------------------
% BAŞLIK VE İÇERİK FORMATLAMA
%----------------------------------------------------------------------------------------

\usepackage{titlesec}
% Bölüm başlıkları ve alt başlıklar için gelişmiş biçimlendirme
\titleformat{\chapter}[display]
    {\normalfont\huge\bfseries}
    {\filcenter\chaptertitlename\ \thechapter}
    {20pt}
    {\Huge\bfseries\filcenter}
    [\vspace{2ex}\rule{\textwidth}{0.5pt}]

% Section başlıkları
\titleformat{\section}
    {\normalfont\Large\bfseries\color{blue!70!black}}
    {\thesection}
    {1em}
    {}
    [\vspace{1ex}\rule{\textwidth}{0.3pt}]

% Subsection başlıkları    
\titleformat{\subsection}
    {\normalfont\large\bfseries\color{blue!50!black}}
    {\thesubsection}
    {1em}
    {}

% Subsubsection başlıkları
\titleformat{\subsubsection}
    {\normalfont\normalsize\bfseries\color{blue!30!black}}
    {\thesubsubsection}
    {1em}
    {}

% Başlık aralıkları
\titlespacing*{\chapter}{0pt}{50pt}{40pt}
\titlespacing*{\section}{0pt}{3.5ex plus 1ex minus .2ex}{2.3ex plus .2ex}
\titlespacing*{\subsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}
\titlespacing*{\subsubsection}{0pt}{3.25ex plus 1ex minus .2ex}{1.5ex plus .2ex}

% Uzun kelime ve URL'lerin otomatik bölünmesi
\usepackage{seqsplit}
\usepackage{ragged2e}

% Tablo hücrelerinde uzun kelimeleri heceleme  
\newcolumntype{P}[1]{>{\RaggedRight\hspace{0pt}}p{#1}}
% M kolonu zaten yukarıda tanımlı - kaldırıldı

% Tablo ayarları birleştirildi
\setlength{\extrarowheight}{2pt}

% Tablo hücrelerinde otomatik kelime kaydırma
\newcolumntype{W}[1]{>{\hspace{0pt}\raggedright\arraybackslash\hspace{0pt}\linebreak[0]\hsize=#1\hsize}X}
\newcolumntype{V}[1]{>{\hspace{0pt}\centering\arraybackslash\hspace{0pt}\linebreak[0]\hsize=#1\hsize}X}

% Font ve metin düzeni birleştirildi (tolerance zaten yukarıda 2000, güncel tutuluyor)
\renewcommand{\footnotesize}{\small}
\hbadness=10000
\hfuzz=5pt
\vfuzz=5pt

% Sayfa başlıkları ve numaraları için
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[RE]{\leftmark}
\fancyhead[LO]{\rightmark}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0pt}
\setlength{\headheight}{29.06204pt}
\addtolength{\topmargin}{-14.06204pt}

% Şekil ve tablo başlıkları için gelişmiş ayarlar
\usepackage[labelfont=bf,font=small,width=0.9\textwidth,labelsep=space]{caption}
\usepackage[labelformat=simple]{subcaption}
\captionsetup[figure]{name=Şekil}
\captionsetup[table]{
    name=Tablo,
    format=plain,
    labelfont={bf,color=blue!70!black},
    textfont={small},
    singlelinecheck=true,
    margin={1cm},
    justification=centering,
    width=0.9\textwidth
}
\renewcommand{\figurename}{Şekil}
\renewcommand{\tablename}{Tablo}

% Figürlerin ve tabloların otomatik yerleşimi için
\makeatletter
\def\fps@figure{htbp}
\def\fps@table{htbp}
\makeatother

% Tablo ve şekillerin otomatik ortalanması
\makeatletter
\g@addto@macro\@floatboxreset{\centering}
\makeatother

% Tekrar tanım - üstteki tablebordercolor kullanılıyor, kaldırıldı

% Uzun tabloların her sayfada başlık tekrarı
\renewcommand{\LTchunksize}{50}
\setlength{\LTcapwidth}{0.9\textwidth}
\setlength{\abovecaptionskip}{6pt}
\setlength{\belowcaptionskip}{6pt}

% Bağlantılar için hyperref (en son yüklenmeli)
\usepackage{microtype}
\usepackage[xetex,unicode,bookmarksnumbered,breaklinks,colorlinks=false]{hyperref}

% Gelişmiş mikro-tipografi ayarları - XeTeX uyumlu
\microtypesetup{
  protrusion=true,
  expansion=false,
  tracking=false,
  spacing=false,
  kerning=false,
  factor=1100
}
\usepackage{bookmark}
\hypersetup{
    pdfencoding=unicode,
    hidelinks,
    pdftitle={Kapsamlı Siber Güvenlik El Kitabı},
    pdfauthor={Yusuf Talha ARABACI},
    pdfsubject={Siber Güvenlik Eğitim Materyali - Creative Commons BY 4.0},
    pdfkeywords={siber güvenlik, cybersecurity, türkçe, eğitim, açık kaynak},
    pdflicenseurl={https://creativecommons.org/licenses/by/4.0/},
    pdflang={tr},
    bookmarksopen=true,
    bookmarksopenlevel=2
}
\pdfstringdefDisableCommands{%
  \def\textit#1{#1}%
  \def\textbf#1{#1}%
}

% İçindekiler için gelişmiş ayarlar
\usepackage{tocloft}
\usepackage[nottoc]{tocbibind}

% İçindekiler başlığını özelleştirme
\renewcommand{\cfttoctitlefont}{\Huge\bfseries}
\renewcommand{\cftchapfont}{\bfseries}
\renewcommand{\cftsecfont}{\normalfont}
\renewcommand{\cftsubsecfont}{\normalfont}

% Nokta liderleri için ayarlar
\renewcommand{\cftchapdotsep}{1}
\renewcommand{\cftsecdotsep}{1}
\renewcommand{\cftsubsecdotsep}{1}

% Bölüm numaralarını kalın yapma
\renewcommand{\cftchappresnum}{\bfseries}
\renewcommand{\cftsecpresnum}{\bfseries}
\renewcommand{\cftsubsecpresnum}{\normalfont}

%----------------------------------------------------------------------------------------
%	KİTAP BİLGİSİ
%----------------------------------------------------------------------------------------
\newcommand{\KitapBaslik}{Kapsamlı Siber Güvenlik El Kitabı}
\newcommand{\KitapAltBaslik}{Teori, Uygulama ve En İyi Pratikler}
\newcommand{\YazarAdi}{Yusuf Talha ARABACI}

\begin{document}

% --- Kapak ---
\begin{titlepage}
  \centering
  \vspace*{2cm}
  % Kapak görseli (img/logo_cis.png örnek)
  %\includegraphics[width=0.25\textwidth]{img/logo_cis.png} \\
  \vspace{1.5cm}
  {\Huge\bfseries \KitapBaslik \par}
  \vspace{0.5cm}
  {\Large \KitapAltBaslik \par}
  \vfill
  {\Large \YazarAdi \par}
  \vspace{1cm}
  {\large \today \par}
\end{titlepage}

\frontmatter
\tableofcontents
\mainmatter

% --- Bölümler (her biri ayrı .tex dosyası, her bölüm yeni sayfada başlar) ---
\include{data/1}
\include{data/2}
\include{data/3}
\include{data/4}
\include{data/5}
\include{data/6}
\include{data/7}
\include{data/8}
\include{data/9}
\include{data/10}
\include{data/11}
\include{data/12}
\include{data/13}
\include{data/14}

\backmatter

\end{document}
